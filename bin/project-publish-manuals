#!/bin/sh -ex
#
# Publishes manuals to the GitHub pages website after a project release.
#
# Written in 2012 by Suraj N. Kurapati <https://github.com/sunaku>

branch=$(git name-rev --name-only HEAD)
trap 'git checkout "$branch"' EXIT
bundle exec binman-rake || binman-rake
rsync -La man/ man-publish/ --delete # resolve symlinks inside man/man0/
git clean -fd man/
git checkout gh-pages
rm -rf man
mv man-publish man
git add man
git commit -C "$branch"
git push "$@"
