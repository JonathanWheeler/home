#!/usr/bin/env ruby
#
# Converts xrdb(1) color schemes into Chrome Secure Shell preferences format
# and prints the result to STDOUT.  Reads STDIN if no input files are given.
#
# Usage: xrdb2hterm FILE...
# Usage: cat FILE... | xrdb2hterm
# Usage: xrdb2hterm < INPUT
#
#--
# Written in 2014 by Suraj N. Kurapati

xrdb = Hash[ ARGF.read.scan(%r{(\w+)\s*:\s*(.*)\s*}) ]

puts <<HTERM
term_.prefs_.set("background-color", "#{ xrdb['background'] }");
term_.prefs_.set("foreground-color", "#{ xrdb['foreground'] }");
term_.prefs_.set("cursor-color", "rgba(#{
  xrdb['cursorColor'].scan(/\h{2}/).map {|s| s.to_i 16 }.join(?,)
}, 0.5)"); /* #{ xrdb['cursorColor'] } */
term_.prefs_.set("color-palette-overrides", #{
  (0..15).map {|i| xrdb["color#{i}"] }
});
HTERM
