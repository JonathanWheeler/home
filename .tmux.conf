# https://wiki.archlinux.org/index.php/Tmux

#-----------------------------------------------------------------------------
# configuration
#-----------------------------------------------------------------------------

# reload this configuration file
bind R source ~/.tmux.conf \; display 'config reloaded!'

# adds 256-color support and modifier key sensing in Vim
# see http://snk.tuxfamily.org/log/vim-256color-bce.html
set -g default-terminal 'xterm-256color'
set -g xterm-keys on

# prevent tmux from catching my keystrokes meant for Vim
set -s escape-time 0

#-----------------------------------------------------------------------------
# windows (views)
#-----------------------------------------------------------------------------

set -g base-index 1

# create window
bind -n M-0 new-window \; command-prompt -I '#W' "rename-window '%%'"
bind -n M-) command-prompt -I '#W' "rename-window '%%'"

# focus window
bind -n "M-'" choose-window
bind -n M-, previous-window
bind -n M-. next-window
bind -n M-1 select-window -t :1
bind -n M-2 select-window -t :2
bind -n M-3 select-window -t :3
bind -n M-4 select-window -t :4
bind -n M-5 select-window -t :5
bind -n M-6 select-window -t :6
bind -n M-7 select-window -t :7
bind -n M-8 select-window -t :8
bind -n M-9 select-window -t :9

# swap window
bind -n S-M-, swap-window -t :-1
bind -n S-M-. swap-window -t :+1

#-----------------------------------------------------------------------------
# panes (clients)
#-----------------------------------------------------------------------------

# create pane
bind -n M-c split-window
bind -n M-r split-window -h

# focus pane
bind -n M-d select-pane -l
bind -n M-h select-pane -L
bind -n M-t select-pane -U
bind -n M-n select-pane -D
bind -n M-s select-pane -R

# resize pane
bind -n M-H resize-pane -L
bind -n M-T resize-pane -U
bind -n M-N resize-pane -D
bind -n M-S resize-pane -R

# toggle maximization of current window pane
# adapted from http://superuser.com/a/433702
bind -n M-m run 'set -e;                                            \
  new_wip=$(tmux display-message -p "#W|#I|#P");                    \
  if ! tmux select-window -t "$new_wip"; then                       \
    old_wip=$(tmux display-message -p "#W");                        \
    old_w=${old_wip%|[0-9]*|[0-9]*};                                \
    if test "$old_w" != "$old_wip"; then                            \
      old_i=${old_wip%|*}; old_i=${old_i##*|};                      \
      old_p=${old_wip##*|};                                         \
      cur_i=$(tmux display-message -p "#I");                        \
      cur_p=$(tmux display-message -p "#P");                        \
      tmux select-window -t ":$old_i";                              \
      tmux select-pane -t ":$old_i.$old_p";                         \
      tmux swap-pane -s ":$cur_i.$cur_p";                           \
      if test "$(tmux list-panes -t ":$cur_i" | wc -l)" -le 1; then \
        tmux kill-window -t ":$cur_i";                              \
      fi;                                                           \
    else                                                            \
      tmux new-window -d -n "$new_wip"                              \
        "trap : INT; while :; do echo PLACEHOLDER; cat; done";      \
      tmux swap-pane -s "$new_wip";                                 \
      tmux select-window -t "$new_wip";                             \
    fi;                                                             \
  fi;                                                               \
'

#-----------------------------------------------------------------------------
# layouts
#-----------------------------------------------------------------------------

bind -n M-V select-layout even-vertical
bind -n M-W select-layout even-horizontal
bind -n M-v select-layout main-vertical
bind -n M-w select-layout main-horizontal
bind -n M-z select-layout tiled

#-----------------------------------------------------------------------------
# clipboard
#-----------------------------------------------------------------------------

setw -g mode-keys vi
set -g set-titles on

bind -n M-u copy-mode -u
bind -n M-i paste-buffer
